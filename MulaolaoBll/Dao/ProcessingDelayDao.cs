using System;
using System . Collections . Generic;
using System . Data;
using System . Linq;
using System . Text;
using StudentMgr;

namespace MulaolaoBll . Dao
{
    public class ProcessingDelayDao
    {
        /// <summary>
        /// 获取数据列表
        /// </summary>
        /// <param name="strWhere"></param>
        /// <returns></returns>
        public DataTable getTableView ( string strWhere )
        {
            StringBuilder strSql = new StringBuilder ( );

            //495
            strSql . AppendFormat ( "WITH CET AS (SELECT PY30,PY01,PY31,PY33,PY25,PY27,PY10*PY11 PY1,PY11,PY10,'' PY2,'' PY3,'' PY4,0 PY5,'' PY6,0 PY7,CASE WHEN PY14*PY18*PY21=0 THEN 0 ELSE (PY10*PY11*PY15*PY12*PY20/PY21/PY14/PY18+PY13*PY19*PY16*PY10*PY11/PY14/PY18/PY21/2)*(1+PY17/100) END U24,CASE WHEN PY14*PY18=0 THEN 0 ELSE PY10*PY11*PY15*PY12/PY14/PY18 END U14,PY23*PY14*PY18*PY11*PY10*PY12*PY15*0.0001 U26,B.RES04 PY8,C.RES04 PY9,CASE WHEN PY06='' OR PY06 IS NULL THEN NULL ELSE PY05 END PY05,CASE WHEN PY32='' OR PY32 IS NULL THEN NULL ELSE PY34 END PY34,CASE WHEN PY39='' OR PY39 IS NULL THEN NULL ELSE PY40 END PY40,PY08,PQF31,PY07,PY41,D.RES04,B.PQF01,PY44,PY45 FROM R_PQY A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.PY01=B.PQF01 INNER JOIN (SELECT RES04,GS01 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.PY01=C.GS01 INNER JOIN R_REVIEWS D ON A.PY33=D.RES06 WHERE RES05='执行' {0}  ) " ,strWhere );
            strSql . Append ( "SELECT PY30,PY01,PY31,PY33,PY25,PY27,PY1,PY11,PY2,PY3,PY4,PY5,PY6,PY7,CASE WHEN U14=0 THEN CASE WHEN PY10=0 THEN 0 ELSE U24/PY10 END ELSE U24/U14+U24/PY10 END PY10,CASE WHEN PY10=0 THEN 0 ELSE (U24+U26)/PY10 END PY009,U24+U26 PY12,PY8,PY9,PY05,PY34,PY40,PY08,PQF31,PY07,PY41,RES04,PQF01,PY44,PY45 FROM CET " );

            strSql . Append ( " UNION ALL " );

            //195
            strSql . Append ( "SELECT CP51,CP01,CP53,CP03,CP06,CP54,CP54*CP13 C1,CP13,CP07,'' C2,'' C3,0 C4,CP08,0 C5,CASE WHEN CP10>0 THEN CP11 ELSE CP11 END C6,CASE WHEN CP10>0 THEN CP13*CP10 ELSE CP11*CP13 END C7,CASE WHEN CP10>0 THEN CP54*CP13*CP10-CP12 ELSE CP54*CP11*CP13-CP12 END C8,B.RES04 C9,C.RES04 C10,CASE WHEN CP32='' OR CP32 IS NULL THEN NULL ELSE CP33 END CP33,CASE WHEN CP34='' OR CP34 IS NULL THEN NULL ELSE CP35 END CP35,CASE WHEN CP38='' OR CP38 IS NULL THEN NULL ELSE CP39 END CP39,CP14,PQF31,'' C11,CP57,D.RES04,PQF01,CP60,CP61 " );
            strSql . AppendFormat ( "FROM R_PQQ A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.CP01=B.PQF01 INNER JOIN (SELECT RES04,GS01 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.CP01=C.GS01 INNER JOIN R_REVIEWS D ON A.CP03=D.RES06 WHERE RES05='执行' {0}" ,strWhere );

            strSql . Append ( " UNION ALL " );

            //196
            strSql . Append ( "SELECT AH98,AH01,AH100,AH97,AH10,AH101,AH101*AH13*AH14 AH1,AH13,AH11,AH12,'' AH2,0 AH3,AH21,AH15,AH16,CASE WHEN AH101=0 THEN 0 ELSE (AH16*AH101*AH13*AH14-AH17)/AH101 END AH4,AH16*AH101*AH13*AH14-AH17 AH5,B.RES04 AH6,C.RES04 AH7,CASE WHEN AH05='' OR AH05 IS NULL THEN NULL ELSE AH06 END AH06,CASE WHEN AH07='' OR AH07 IS NULL THEN NULL ELSE AH08 END AH08,CASE WHEN AH92='' OR AH92 IS NULL THEN NULL ELSE AH93 END AH93,AH22,PQF31,DBA002,AH112,D.RES04,B.PQF01,AH115,AH116 " );
            strSql . AppendFormat ( "FROM R_PQAH A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.AH01=B.PQF01 INNER JOIN (SELECT RES04,GS01 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.AH01=C.GS01 INNER JOIN R_REVIEWS D ON A.AH97=D.RES06 INNER JOIN TPADBA E ON A.AH02=E.DBA001 WHERE RES05='执行' {0} " ,strWhere );

            strSql . Append ( " UNION ALL " );

            //505
            strSql . Append ( "SELECT IZ004,IZ002,IZ003,IZ001,IZ008,IZ005,IZ005*IZ022 IZ0,IZ022,CONVERT(VARCHAR,IZ013)+'*'+CONVERT(VARCHAR,IZ014)+'*'+CONVERT(VARCHAR,IZ015) IZ1,'' IZ2,'' IZ3,0 IZ4,'颗' IZ5,0 IZ6,CASE WHEN IZ021=0 THEN 0 ELSE IZ013*(IZ014+IZ015)*2*IZ016/IZ021 END IZ7,CASE WHEN IZ005=0 THEN 0 WHEN IZ021=0 THEN 0 ELSE IZ005*IZ022/IZ021*IZ013*(IZ014+IZ015)*2*IZ016/IZ005 END IZ8,CASE WHEN IZ021=0 THEN 0 ELSE IZ005*IZ022/IZ021*IZ013*(IZ014+IZ015)*2*IZ016 END IZ9,B.RES04 IZ10,C.RES04 IZ11,CASE WHEN IZ006='' OR IZ006 IS NULL THEN NULL ELSE IZ018 END IZ018,CASE WHEN IZ030='' OR IZ030 IS NULL THEN NULL ELSE IZ031 END IZ031,CASE WHEN IZ028='' OR IZ028 IS NULL THEN NULL ELSE IZ029 END IZ029,IZ017,PQF31,IZ035,'' IZ12,D.RES04,PQF01,IZ036,IZ037 " );
            strSql . AppendFormat ( "FROM R_PQIZ A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.IZ002=B.PQF01 INNER JOIN (SELECT RES04,GS01 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.IZ002=C.GS01 INNER JOIN R_REVIEWS D ON A.IZ001=D.RES06 WHERE RES05='执行' {0}" ,strWhere );

            return SqlHelper . ExecuteDataTable ( strSql . ToString ( ) );
        }

        /// <summary>
        /// 获取产品名称
        /// </summary>
        /// <returns></returns>
        public DataTable getTablePro ( )
        {
            StringBuilder strSql = new StringBuilder ( );
            strSql . Append ( "SELECT PQF01,PQF04,PQF03 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行'" );

            return SqlHelper . ExecuteDataTable ( strSql . ToString ( ) );
        }
    }
}
