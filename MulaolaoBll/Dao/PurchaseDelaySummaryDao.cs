using System;
using System . Collections . Generic;
using System . Data;
using System . Linq;
using System . Text;
using StudentMgr;

namespace MulaolaoBll . Dao
{
    public class PurchaseDelaySummaryDao
    {
        /// <summary>
        /// 获取数据列表
        /// </summary>
        /// <returns></returns>
        public DataTable getTableView ( string strWhere )
        {
            StringBuilder strSql = new StringBuilder ( );
            
            //349
            strSql . Append ( "WITH CET AS (SELECT WX83,WX01,WX85,WX82,WX10,WX86,CASE WHEN WX17='外购' THEN WX87 ELSE WX16 END WX17,WX14,'' W1,'' W2,WX19,WX12,WX13,B.RES04 W3,C.RES04 W4,CASE WHEN WX10='双瓦外箱' THEN ((WX27 + WX28 + WX29) * (WX30 + WX31 + WX32) + (WX23 + WX24) * (WX25 + WX26)) * 0.0001 * WX13 * WX15 WHEN WX10='小箱式' THEN ((WX27 + WX28 + WX29) * (WX30 + WX31 + WX32) + (WX23 + WX24) * (WX25 + WX26)) * 0.0001 * WX13 * WX15 WHEN WX10='牙膏式' THEN ((WX27 + 2*WX28 + WX29) * (2*WX30 + 2*WX31 + WX32) +(WX23 + WX24) * (WX25 + WX26)) * 0.0001*WX13* WX15  WHEN WX10='插口式' THEN ((WX27 + 2*WX28 + WX29) * (2*WX30 + 2*WX31 + WX32) +(WX23 + WX24) * (WX25 + WX26)) * 0.0001*WX13* WX15 WHEN WX10='天盖' THEN ((WX27 + 2*WX28 + WX29) * (WX30 + 2*WX31 + WX32) +(WX23 + WX24) * (WX25 + WX26)) * 0.0001*WX13* WX15 WHEN WX10='地盖' THEN ((WX27 + 2*WX28 + WX29) * (WX30 + 2*WX31 + WX32) +(WX23 + WX24) * (WX25 + WX26)) * 0.0001*WX13* WX15 WHEN WX10='折叠式' THEN ((2*WX27 + 2*WX28 + WX29) * (1.5*WX30 + WX31 + WX32) +(WX23 + WX24) * (WX25 + WX26)) * 0.0001*WX13* WX15 WHEN WX10 NOT IN ('双瓦外箱','小箱式','牙膏式','插口式','天盖','地盖','折叠式') THEN (WX23 + WX24) * (WX25 + WX26) * 0.0001 * WX13* WX15 END PQ,CASE WHEN WX05='' OR WX05 IS NULL THEN NULL ELSE WX06 END WX06,CASE WHEN WX07='' OR WX07 IS NULL THEN NULL ELSE WX08 END WX08,CASE WHEN WX75='' OR WX75 IS NULL THEN NULL ELSE WX76 END WX76,WX21,PQF31,DBA002,WX91,E.RES04,PQF01,WX94,WX95,WX05 " );
            strSql . AppendFormat ( "FROM R_PQT A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.WX01=B.PQF01 INNER JOIN (SELECT DISTINCT GS01,RES04 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.WX01=C.GS01 INNER JOIN TPADBA D ON A.WX02=D.DBA001 INNER JOIN R_REVIEWS E ON A.WX82=E.RES06 WHERE RES05='执行' {0}) " ,strWhere );
            strSql . Append ( "SELECT WX83 BA051,WX01 BA001,WX85 BA053,WX82 BA003,WX10 BA006,WX86 BA054,WX17 BA054,WX14 B1,W1 BA007,W2 B2,WX19 BA008,WX12 BA010,WX13 BA011,CASE WHEN WX86=0 THEN 0 ELSE PQ/WX86 END BA013,PQ B3,W3 B4,W4 B5,WX06 BA033,WX08 BA035,WX76 BA039,WX21 BA014,PQF31,DBA002,WX91 BA057,RES04,PQF01,WX94,WX95,WX05 FROM CET " );

            strSql . Append ( " UNION ALL " );

            //199
            strSql . Append ( "SELECT BA051,BA001,BA053,BA003,BA006,BA054,BA054,1 B1,BA007,'' B2,BA008,BA010,BA011,BA013,BA054*BA013 B3,B.RES04 B4,C.RES04 B5,CASE WHEN BA032='' OR BA032 IS NULL THEN NULL ELSE BA033 END BA033,CASE WHEN BA034='' OR BA034 IS NULL THEN NULL ELSE BA035 END BA035,CASE WHEN BA038='' OR BA038 IS NULL THEN NULL ELSE BA039 END BA039,BA014,PQF31,DBA002,BA057,E.RES04,PQF01,BA061,BA062,BA032 " );
            strSql . AppendFormat ( "FROM R_PQBA A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.BA001=B.PQF01 INNER JOIN (SELECT DISTINCT GS01,RES04 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.BA001=C.GS01 INNER JOIN TPADBA D ON A.BA002=D.DBA001 INNER JOIN R_REVIEWS E ON A.BA003=E.RES06 WHERE RES05='执行' {0}" ,strWhere );

            strSql . Append ( " UNION ALL " );

            //338
            strSql . Append ( "SELECT JM100,JM90,JM102,JM01,JM09,JM103,CASE WHEN JM14='外购' THEN JM104 ELSE JM15 END J1,JM10,CONVERT(VARCHAR,JM94)+'*'+CONVERT(VARCHAR,JM95)+'*'+CONVERT(VARCHAR,JM96) J2,'' J3,'张' J4,JM12,CASE WHEN JM94=0 THEN 0 WHEN JM95=0 THEN 0 WHEN JM96=0 THEN 0 ELSE JM11/JM94/JM95/JM96/0.000001 END J5,CASE WHEN JM10=0 THEN 0 ELSE JM11/JM10 END J6,CASE WHEN JM10=0 THEN 0 ELSE JM103/JM10*JM11 END J7,B.RES04 J8,C.RES04 J9,CASE WHEN JM04='' OR JM04 IS NULL THEN NULL ELSE JM05 END JM05,CASE WHEN JM06='' OR JM06 IS NULL THEN NULL ELSE JM07 END JM07,CASE WHEN JM87='' OR JM87 IS NULL THEN NULL ELSE JM88 END JM88,JM16,PQF31,DBA002,JM108,E.RES04,PQF01,JM114,JM115,JM04  " );
            strSql . AppendFormat ( "FROM R_PQO A INNER JOIN (SELECT DISTINCT RES04,PQF01,PQF31 FROM R_PQF B INNER JOIN R_REVIEWS C ON B.PQF01=RES06 WHERE RES05='执行') B ON A.JM90=B.PQF01 INNER JOIN (SELECT DISTINCT RES04,GS01 FROM R_PQP D INNER JOIN R_REVIEWS C ON C.RES06=D.GS34 WHERE RES05='执行') C ON A.JM90=C.GS01 INNER JOIN TPADBA D ON A.JM02=D.DBA001 INNER JOIN R_REVIEWS E ON A.JM01=E.RES06 WHERE RES05='执行' {0}" ,strWhere );

            strSql . Append ( " UNION ALL " );

            //339
            strSql . Append ( "SELECT YQ105,YQ03,YQ107,YQ99,YQ10,YQ108,CASE WHEN YQ101='外购' THEN YQ109 ELSE YQ19 END YQ101,YQ112,YQ12,'' Y1,'斤' Y2,0 Y3,YQ15,YQ112*YQ116*YQ113*YQ13*YQ14*0.01/YQ114/YQ115+YQ16*YQ112*YQ114*YQ115*YQ116*YQ113*0.0001*YQ13*0.01 Y5,YQ16*YQ108*YQ112*YQ114*YQ115*YQ116*YQ113*0.0001*YQ13*0.01+YQ108*YQ112*YQ116*YQ113*YQ13*YQ14*0.01/YQ114/YQ115 Y6,B.RES04 Y7,C.RES04 Y8,CASE WHEN YQ04='' OR YQ04 IS NULL THEN NULL ELSE YQ05 END YQ05,CASE WHEN YQ07='' OR YQ07 IS NULL THEN NULL ELSE YQ08 END YQ08,CASE WHEN YQ96='' OR YQ96 IS NULL THEN NULL ELSE YQ97 END YQ97,YQ17,PQF31,DBA002,YQ124,E.RES04,PQF01,YQ136,YQ137,YQ04 " );
            strSql . AppendFormat ( "FROM R_PQI A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.YQ03=B.PQF01 INNER JOIN (SELECT DISTINCT GS01,RES04 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.YQ03=C.GS01 INNER JOIN TPADBA D ON A.YQ01=D.DBA001 INNER JOIN R_REVIEWS E ON A.YQ99=E.RES06 WHERE RES05='执行' AND YQ99 LIKE 'R_339%' {0}" ,strWhere );

            strSql . Append ( " UNION ALL " );

            //341
            strSql . Append ( "SELECT PQV77,PQV01,PQV79,PQV76,PQV10,PQV80,CASE WHEN PQV65='外购' THEN PQV82 ELSE PQV64 END PQV65,PQV12,CONVERT(VARCHAR,PQV66)+'*'+CONVERT(VARCHAR,PQV81)+'*'+CONVERT(VARCHAR,PQV67) P1,'' P2,'m³' P3,0 P4,PQV11,CASE WHEN PQV80=0 THEN 0 ELSE PQV66*PQV81*PQV67*PQV11*PQV13/PQV80 END P5,PQV11*PQV66*PQV81*PQV67*PQV13 P6,B.RES04 P7,C.RES04 P8,CASE WHEN PQV05='' OR PQV05 IS NULL THEN NULL ELSE PQV06 END PQV06,CASE WHEN PQV07='' OR PQV07 IS NULL THEN NULL ELSE PQV08 END PQV08,CASE WHEN PQV62='' OR PQV62 IS NULL THEN NULL ELSE PQV63 END PQV63,PQV23,PQF31,DBA002,PQV89,E.RES04,PQF01,PQV95,PQV96,PQV05 " );
            strSql . AppendFormat ( "FROM R_PQV A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.PQV01=B.PQF01 INNER JOIN (SELECT DISTINCT GS01,RES04 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.PQV01=C.GS01 INNER JOIN TPADBA D ON A.PQV02=D.DBA001 INNER JOIN R_REVIEWS E ON A.PQV76=E.RES06 WHERE RES05='执行' {0}" ,strWhere );

            strSql . Append ( " UNION ALL " );

            //342
            strSql . Append ( "SELECT AF003,AF002,AF004,AF001,AF015,AF006,CASE WHEN AF016='外购' THEN AF017 ELSE AF018 END AF016,AF019,CONVERT(VARCHAR,AF020)+'*'+CONVERT(VARCHAR,AF021)+'*'+CONVERT(VARCHAR,AF022) A1,'' A2,'cm³' A3,0 A4,CASE WHEN AF020=0 THEN 0 WHEN AF021=0 THEN 0 WHEN AF022=0 THEN 0 ELSE AF023/AF020/AF021/AF022*1000000 END A5,AF023*AF019 A6,AF023*AF006*AF019 A7,B.RES04 A8,C.RES04 A9,CASE WHEN AF010='' OR AF010 IS NULL THEN NULL ELSE AF014 END AF014,CASE WHEN AF012='' OR AF012 IS NULL THEN NULL ELSE AF013 END AF013,CASE WHEN AF072='' OR AF072 IS NULL THEN NULL ELSE AF073 END AF073,AF024,PQF31,DBA002,AF079,E.RES04,PQF01,AF085,AF086,AF010 " );
            strSql . AppendFormat ( "FROM R_PQAF A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.AF002=B.PQF01 INNER JOIN (SELECT DISTINCT GS01,RES04 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.AF002=C.GS01 INNER JOIN TPADBA D ON A.AF007=D.DBA001 INNER JOIN R_REVIEWS E ON A.AF001=E.RES06 WHERE RES05='执行' {0}" ,strWhere );

            strSql . Append ( " UNION ALL " );

            //343
            strSql . Append ( "SELECT PQU98,PQU01,PQU100,PQU97,PQU10,PQU101,CASE WHEN PQU19='外购' THEN PQU104 ELSE PQU18 END PQU19,PQU13,PQU12,PQU11,PQU21,PQU15,PQU16,PQU16*PQU13 P0,PQU16*(PQU101*PQU13+PQU14)-PQU17 P1,B.RES04 P2,C.RES04 P3,CASE WHEN PQU05='' OR PQU05 IS NULL THEN NULL ELSE PQU06 END PQU06,CASE WHEN PQU07='' OR PQU07 IS NULL THEN NULL ELSE PQU08 END PQU08,CASE WHEN PQU92='' OR PQU92 IS NULL THEN NULL ELSE PQU93 END PQU93,PQU22,PQF31,DBA002,PQU108,E.RES04,PQF01,PQU113,PQU114,PQU05 " );
            strSql . AppendFormat ( "FROM R_PQU A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.PQU01=B.PQF01 INNER JOIN (SELECT DISTINCT GS01,RES04 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.PQU01=C.GS01 INNER JOIN TPADBA D ON A.PQU02=D.DBA001 INNER JOIN R_REVIEWS E ON A.PQU97=E.RES06 WHERE RES05 = '执行' {0}" ,strWhere );

            strSql . Append ( " UNION ALL " );

            //347
            strSql . Append ( "SELECT PJ93,PJ01,PJ95,PJ92,PJ09,PJ96,CASE WHEN PJ15='外购' THEN PJ97 ELSE PJ14 END PJ15,PJ11,PJ89,'' P1,PJ17,PJ13,PJ12,PJ11*PJ12 P2,PJ16,B.RES04 P3,C.RES04 P4,CASE WHEN PJ04='' OR PJ04 IS NULL THEN NULL ELSE PJ05 END PJ05,CASE WHEN PJ06='' OR PJ06 IS NULL THEN NULL ELSE PJ07 END PJ07,CASE WHEN PJ85='' OR PJ85 IS NULL THEN NULL ELSE PJ86 END PJ86,PJ19,PQF31,DBA002,PJ101,E.RES04,PQF01,PJ107,PJ108,PJ04 " );
            strSql . AppendFormat ( "FROM R_PQS A INNER JOIN (SELECT RES04,PQF01,PQF31 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行') B ON A.PJ01=B.PQF01 INNER JOIN (SELECT DISTINCT GS01,RES04 FROM R_PQP A INNER JOIN R_REVIEWS B ON A.GS34=B.RES06 WHERE RES05='执行') C ON A.PJ01=C.GS01 INNER JOIN TPADBA D ON A.PJ02=D.DBA001 INNER JOIN R_REVIEWS E ON A.PJ92=E.RES06 WHERE RES05='执行' {0}" ,strWhere );

            return SqlHelper . ExecuteDataTable ( strSql . ToString ( ) );
        }

        /// <summary>
        /// 获取产品名称
        /// </summary>
        /// <returns></returns>
        public DataTable getTablePro ( )
        {
            StringBuilder strSql = new StringBuilder ( );
            strSql . Append ( "SELECT PQF01,PQF04,PQF03 FROM R_PQF A INNER JOIN R_REVIEWS B ON A.PQF01=B.RES06 WHERE RES05='执行'" );

            return SqlHelper . ExecuteDataTable ( strSql . ToString ( ) );
        }

    }
}
